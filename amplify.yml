version: 1
applications:
  - frontend:
      phases:
        preBuild:
          commands:
            - echo "Node $(node -v)"
            - echo "PWD $(pwd)"
            - 'echo "Listing GEMINI related env vars (names only):" && (printenv | grep -i GEMINI || echo "NONE")'
            - npm ci
        build:
          commands:
            - npm run build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
    # Important: Configure environment variables for runtime (Lambda)
    environment:
      variables:
        # These will be available at runtime in API routes
        GEMINI_API_KEY: ${GEMINI_API_KEY}
        NEXT_PUBLIC_GEMINI_MODEL: ${NEXT_PUBLIC_GEMINI_MODEL}
        GEMINI_SYSTEM_PROMPT: ${GEMINI_SYSTEM_PROMPT}
        AWS_REGION: us-east-1
        # Skip Secrets Manager since IAM role not configured yet
        # We're using environment variables directly (which are working!)
        SKIP_SECRETS_MANAGER: "true"
